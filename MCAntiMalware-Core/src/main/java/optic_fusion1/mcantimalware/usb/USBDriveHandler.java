package optic_fusion1.mcantimalware.usb;

import java.io.File;
import optic_fusion1.mcantimalware.Main;
import optic_fusion1.mcantimalware.scanner.Scanner;
import optic_fusion1.mcantimalware.utils.usbdetector.USBDeviceDetectorManager;
import optic_fusion1.mcantimalware.utils.usbdetector.events.DeviceEventType;
import optic_fusion1.mcantimalware.utils.usbdetector.events.IUSBDriveListener;
import optic_fusion1.mcantimalware.utils.usbdetector.events.USBStorageEvent;

public class USBDriveHandler implements IUSBDriveListener {

  private final Scanner scanner;

  public USBDriveHandler(Main main) {
    scanner = main.getScanner();
    USBDeviceDetectorManager driveDetector = new USBDeviceDetectorManager(main.getLogger());
    driveDetector.addDriveListener(this);
    driveDetector.setPollingInterval(1);
  }

  @Override
  public void usbDriveEvent(USBStorageEvent event) {
    if (event.getEventType() == DeviceEventType.CONNECTED) {
      for (File file : event.getStorageDevice().getRootDirectory().listFiles()) {
        if (file.isDirectory()) {
          scanner.addDirectoryToQueue(file.toPath());
        } else {
          scanner.addFileToQueue(file.toPath());
        }
      }
    }
  }

}
