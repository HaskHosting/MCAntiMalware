package optic_fusion1.mcantimalware.utils;

import java.io.File;
import java.io.IOException;
import java.util.UUID;
import net.lingala.zip4j.ZipFile;
import static optic_fusion1.mcantimalware.Main.LOGGER;
import org.apache.commons.io.FileUtils;

public final class ZipUtils {

  private static final File DATA_FOLDER = new File("AntiMalware");

  private ZipUtils() {
  }

  public static File unzipFileToTempDir(String source) {
    File unzippedDir = new File(DATA_FOLDER, "unzipped");
    if (!unzippedDir.exists()) {
      unzippedDir.mkdirs();
    }
    File tempDir = new File(unzippedDir, UUID.randomUUID().toString());
    if (!tempDir.exists()) {
      tempDir.mkdir();
    }
    try {
      ZipFile zipFile = new ZipFile(source);
      zipFile.extractAll(tempDir.toString());
      File file = new File(tempDir, "file.info");
      if (!file.exists()) {
        file.createNewFile();
      }
      FileUtils.writeStringToFile(file, source, "UTF-8");
    } catch (IOException ex) {
      LOGGER.exception(ex);
    }
    return tempDir;
  }
}
