package optic_fusion1.antimalware.scanner;

import java.io.File;
import optic_fusion1.antimalware.AntiMalware;
import optic_fusion1.antimalware.utils.usbdetector.USBDeviceDetectorManager;
import optic_fusion1.antimalware.utils.usbdetector.events.DeviceEventType;
import optic_fusion1.antimalware.utils.usbdetector.events.IUSBDriveListener;
import optic_fusion1.antimalware.utils.usbdetector.events.USBStorageEvent;

public class USBDriveScanner implements IUSBDriveListener {

  private Scanner scanner;

  public USBDriveScanner(AntiMalware antiMalware) {
    scanner = antiMalware.getScanner();
    USBDeviceDetectorManager driveDetector = new USBDeviceDetectorManager();
    driveDetector.addDriveListener(this);
    driveDetector.setPollingInterval(1);
  }

  @Override
  public void usbDriveEvent(USBStorageEvent event) {
    if (event.getEventType() != DeviceEventType.CONNECTED) {
      return;
    }
    for (File file : event.getStorageDevice().getRootDirectory().listFiles()) {
      if (file.isDirectory()) {
        scanner.addDirectoryToQueue(file.toPath());
      } else {
        scanner.addFileToQueue(file.toPath());
      }
    }
  }
}
