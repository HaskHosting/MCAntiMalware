package optic_fusion1.antimalware.scanner.realtime;

import java.io.File;
import java.nio.file.Path;
import optic_fusion1.antimalware.AntiMalware;
import static optic_fusion1.antimalware.AntiMalware.LOGGER;
import optic_fusion1.antimalware.scanner.Scanner;

public class RealTimeScanner extends Scanner {

  public RealTimeScanner(AntiMalware antiMalware, File scanDirectory) {
    super(antiMalware, scanDirectory);
  }

  public void setupDirectoryWatcher() {
    DirectoryWatcher directoryWatcher = new DirectoryWatcher.Builder().addDirectories(getScanDirectory().toPath())
            .setPreExistingAsCreated(true).build(getAntiMalware(), (DirectoryWatcher.Event event, Path path) -> {
      switch (event) {
        case ENTRY_CREATE:
          addFileToQueue(path);
          break;
        case ENTRY_MODIFY:
          addFileToQueue(path);
          break;
        case ENTRY_DELETE:
          break;
      }
    });

    try {
      directoryWatcher.startService(); // Actual watching starts here
    } catch (Exception e) {
      LOGGER.exception(e);
    }
  }

}
