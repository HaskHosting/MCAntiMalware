package optic_fusion1.mcantimalware.transformer;

import java.util.HashMap;
import me.yamakaja.runtimetransformer.annotation.Inject;
import me.yamakaja.runtimetransformer.annotation.InjectionType;
import me.yamakaja.runtimetransformer.annotation.Transform;
import optic_fusion1.mcantimalware.AntiMalware;
import optic_fusion1.mcantimalware.exceptions.FormattedSecurityException;
import optic_fusion1.mcantimalware.runtimeprotect.callerinfo.CallerInfo;
import optic_fusion1.mcantimalware.runtimeprotect.callerinfo.RuntimeUtils;
import org.bukkit.craftbukkit.v1_15_R1.inventory.CraftInventory;
import org.bukkit.inventory.ItemStack;

@Transform(CraftInventory.class)
public class CraftInventoryTransformer1_15 {

  @Inject(InjectionType.INSERT)
  public HashMap<Integer, ItemStack> addItem(ItemStack... items) {
    CallerInfo callerInfo = RuntimeUtils.getCallerInfo();
    if (callerInfo != null) {
      if (AntiMalware.getCheckManager().isPluginJarBlacklisted(callerInfo.getPlugin().getJar())) {
        throw new FormattedSecurityException("File: {0} is malicious", new Object[]{callerInfo.getPlugin().getJar()});
      }
    }
    throw null;
  }

}
