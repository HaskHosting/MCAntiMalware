package optic_fusion1.mcantimalware.transformer;

import java.util.Set;
import me.yamakaja.runtimetransformer.annotation.Inject;
import me.yamakaja.runtimetransformer.annotation.InjectionType;
import me.yamakaja.runtimetransformer.annotation.Transform;
import optic_fusion1.mcantimalware.AntiMalware;
import org.bukkit.entity.Player;
import org.bukkit.event.player.AsyncPlayerChatEvent;

@Transform(AsyncPlayerChatEvent.class)
public class AsyncPlayerChatEventTransformer extends AsyncPlayerChatEvent {

  public AsyncPlayerChatEventTransformer(boolean async, Player who, String message, Set<Player> players) {
    super(async, who, message, players);
  }

  @Inject(InjectionType.INSERT)
  @Override
  public void setCancelled(boolean cancel) {
    if (cancel) {
      String message = getMessage();
      if (AntiMalware.getCheckManager().isStringBlacklisted(message)) {
        setCancelled(false);
        //TODO: Figure out what to do with the player, can't kick/ban since those need to be ran sync
      }
    }
  }

}
