package optic_fusion1.mcantimalware.usb;

import java.io.File;
import java.io.IOException;
import net.samuelcampos.usbdrivedetector.USBDeviceDetectorManager;
import net.samuelcampos.usbdrivedetector.events.DeviceEventType;
import net.samuelcampos.usbdrivedetector.events.IUSBDriveListener;
import net.samuelcampos.usbdrivedetector.events.USBStorageEvent;
import optic_fusion1.mcantimalware.AntiMalware;
import optic_fusion1.mcantimalware.realtimescanning.Scanner;

public class USBDriveHandler implements IUSBDriveListener {

  private static final Scanner SCANNER = AntiMalware.getRealTimeScanner().getScanner();

  public USBDriveHandler() {
    USBDeviceDetectorManager driveDetector = new USBDeviceDetectorManager();
    driveDetector.addDriveListener(this);
    driveDetector.setPollingInterval(1);
  }

  @Override
  public void usbDriveEvent(USBStorageEvent event) {
    if (event.getEventType() == DeviceEventType.CONNECTED) {
      for (File file : event.getStorageDevice().getRootDirectory().listFiles()) {
        if(file.isDirectory()){
          SCANNER.scanDirectory(file);
        }else {
          try {
            SCANNER.scanFile(file);
          } catch (IOException ex) {
            AntiMalware.getLogger().exception(ex);
          }
        }
      }
    }
  }

}
